

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Standardized Research &mdash; NinoLearn 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/logo_favicon.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Deep ensemble for ENSO-forecasting" href="deep_ensemble.html" />
    <link rel="prev" title="Postprocess data" href="postprocess_data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../package.html">NinoLearn package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="download_and_read_raw_data.html">Download and read raw data</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html">Data preparation and read postprocessed data</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocess_data.html">Postprocess data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Standardized Research</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Download">Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Prepare-data">Prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Build-a-new-Model">Build a new Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Data-pipeline">Data pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-model">The model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Cross-train-the-model">Cross train the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Make-hindcast">Make hindcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Evaluation">Evaluation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deep_ensemble.html">Deep ensemble for ENSO-forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="encoder_decoder.html">Encoder-Decoder model for ENSO-forecasting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../forecasts.html">Some forecasts</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NinoLearn</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Standardized Research</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/jupyter_notebook_tutorials/StandardizedResearch.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Standardized-Research">
<h1>Standardized Research<a class="headerlink" href="#Standardized-Research" title="Permalink to this headline">¶</a></h1>
<p>This tutorial covers in a simple example of a Lasso regression model all steps in the development process of a new model that follows the standards of NinoLearn.</p>
<div class="section" id="Download">
<h2>Download<a class="headerlink" href="#Download" title="Permalink to this headline">¶</a></h2>
<p>Download four indeces which we want to use to predict the Oceaninc Nino Index (ONI):</p>
<ol class="arabic simple">
<li><p>The ONI index itself.</p></li>
<li><p>The Dipole Mode Index of the Indian Ocean Dipole (IOD)</p></li>
<li><p>The Warm Water Volume (WWV)</p></li>
<li><p>The Kiritimati Index that can be used as WWV proxy form 1955 onwards.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ninolearn.download</span> <span class="k">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">sources</span>

<span class="n">download</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">ONI</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">IOD</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">WWV</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">KINDEX</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
oni.txt already downloaded
iod.txt already downloaded
wwv.dat already downloaded
Copy Kindex.mat to data directory
</pre></div></div>
</div>
</div>
<div class="section" id="Prepare-data">
<h2>Prepare data<a class="headerlink" href="#Prepare-data" title="Permalink to this headline">¶</a></h2>
<p>Extract the essential data form the raw files and move them into preprocessed data directory. If you are interested what these functions exactly do, check out there source code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ninolearn.preprocess.prepare</span> <span class="k">import</span> <span class="n">prep_oni</span><span class="p">,</span> <span class="n">prep_wwv</span>
<span class="kn">from</span> <span class="nn">ninolearn.preprocess.prepare</span> <span class="k">import</span> <span class="n">prep_iod</span><span class="p">,</span> <span class="n">prep_K_index</span><span class="p">,</span> <span class="n">prep_wwv_proxy</span>


<span class="n">prep_oni</span><span class="p">()</span>
<span class="n">prep_wwv</span><span class="p">()</span>
<span class="n">prep_iod</span><span class="p">()</span>
<span class="n">prep_K_index</span><span class="p">()</span>

<span class="c1"># combines the WWV and the K-Index to one WWV proxy</span>
<span class="n">prep_wwv_proxy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Prepare ONI timeseries.
Prepare WWV  timeseries.
Prepare IOD timeseries.
</pre></div></div>
</div>
</div>
<div class="section" id="Build-a-new-Model">
<h2>Build a new Model<a class="headerlink" href="#Build-a-new-Model" title="Permalink to this headline">¶</a></h2>
<p>Here an example of an multilinear (Lasso) regression model is given that is based on the scikit-learn python package.</p>
<div class="section" id="Data-pipeline">
<h3>Data pipeline<a class="headerlink" href="#Data-pipeline" title="Permalink to this headline">¶</a></h3>
<p>First a data pipeline is build. The pipeline is used during training, prediction and evaluation to generate the feature, the label, the time as well as (optional) the persistance forecast.</p>
<p>When you build a new data pipeline, it needs to have the same structure as the code block below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># import the data reader to read data from the preprocessed data directory</span>
<span class="kn">from</span> <span class="nn">ninolearn.IO.read_processed</span> <span class="k">import</span> <span class="n">data_reader</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">pipeline</span><span class="p">(</span><span class="n">lead_time</span><span class="p">,</span>  <span class="n">return_persistance</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data pipeline for the processing of the data before the lasso regression model</span>
<span class="sd">    is trained.</span>

<span class="sd">    :type lead_time: int</span>
<span class="sd">    :param lead_time: The lead time in month.</span>

<span class="sd">    :type return_persistance: boolean</span>
<span class="sd">    :param return_persistance: Return as the persistance as well.</span>

<span class="sd">    :returns: The feature &quot;X&quot; (at observation time), the label &quot;y&quot; (at lead</span>
<span class="sd">    time), the target season &quot;timey&quot; (least month) and if selected the</span>
<span class="sd">    label at observation time &quot;y_persistance&quot;. Hence, the output comes as:</span>
<span class="sd">    X, y, timey, y_persistance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize the reader</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">data_reader</span><span class="p">(</span><span class="n">startdate</span><span class="o">=</span><span class="s1">&#39;1960-01&#39;</span><span class="p">,</span> <span class="n">enddate</span><span class="o">=</span><span class="s1">&#39;2017-12&#39;</span><span class="p">)</span>

    <span class="c1"># Load data</span>
    <span class="c1"># HERE you could load other data sources</span>
    <span class="n">oni</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;oni&#39;</span><span class="p">)</span>
    <span class="n">wwv</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;wwv_proxy&#39;</span><span class="p">)</span>
    <span class="n">iod</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;iod&#39;</span><span class="p">)</span>

    <span class="c1"># the shift data by 3 in addition to lead time shift (due to definition</span>
    <span class="c1"># of lead time) as in barnston et al. (2012)</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># Make feature</span>
    <span class="c1"># HERE you need to stack you data if you loaded different data sets</span>
    <span class="n">Xorg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">oni</span><span class="p">,</span> <span class="n">wwv</span><span class="p">,</span> <span class="n">iod</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Xorg</span><span class="p">[:</span><span class="o">-</span><span class="n">lead_time</span><span class="o">-</span><span class="n">shift</span><span class="p">,:]</span>

    <span class="c1"># arange label</span>
    <span class="n">yorg</span> <span class="o">=</span> <span class="n">oni</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">yorg</span><span class="p">[</span><span class="n">lead_time</span> <span class="o">+</span> <span class="n">shift</span><span class="p">:]</span>

    <span class="c1"># get the time axis of the label</span>
    <span class="n">timey</span> <span class="o">=</span> <span class="n">oni</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">lead_time</span> <span class="o">+</span> <span class="n">shift</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">return_persistance</span><span class="p">:</span>
        <span class="n">y_persistance</span> <span class="o">=</span> <span class="n">yorg</span><span class="p">[:</span> <span class="o">-</span> <span class="n">lead_time</span> <span class="o">-</span> <span class="n">shift</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">timey</span><span class="p">,</span> <span class="n">y_persistance</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">timey</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-model">
<h3>The model<a class="headerlink" href="#The-model" title="Permalink to this headline">¶</a></h3>
<p>First of all, the newly designed model needs to inherit from the baseModel such that the model can be trained and evaluated in a standardized procedure furhter down.</p>
<p>The model has mandatory variables and functions that need to be included. These parts are highlighted in the following with the comment “MANDATORY”</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># import the baseModel from which the mlr class needs to inherit</span>
<span class="kn">from</span> <span class="nn">ninolearn.learn.models.baseModel</span> <span class="k">import</span> <span class="n">baseModel</span>

<span class="c1"># import the sklearn model that we want to use for the ENSO forecast</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Lasso</span>

<span class="c1"># import some packages and methods to saving the model later</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">exists</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">mkdir</span>

<span class="c1"># MANDATORY: Needs to in herit from the class baseModel</span>
<span class="k">class</span> <span class="nc">mlr</span><span class="p">(</span><span class="n">baseModel</span><span class="p">):</span>

    <span class="c1"># MANDETORY: Define how many outputs your model has</span>
    <span class="n">n_outputs</span><span class="o">=</span><span class="mi">1</span>

    <span class="c1"># MANDETORY: The name that is used when predictions are saved in an netCDF file.</span>
    <span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span>


    <span class="c1"># MANDETORY: The model needs to have a .__init__() method.</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mlr&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The model needs to have an __init__ function. That takes contains</span>
<span class="sd">        receives the hyperparameters of the model as well as the name of the</span>
<span class="sd">        model as keyword arguments</span>

<span class="sd">        :type alpha: float</span>
<span class="sd">        :param alpha: The coefficent for the lasso penatly term.</span>

<span class="sd">        :type name: str</span>
<span class="sd">        :param name: The name of the model that is used to save it to a file after training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  MANDETORY: Apply the .set_hyperparameters function to all keyword arguments.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_hyperparameters</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>



    <span class="c1"># MANDETORY: The model needs to have a .fit() function that takes trainX, trainy as arguments.</span>
    <span class="c1"># Very complex models, e.g. neural networks would need to split the trainX and trainy variables further</span>
    <span class="c1"># to generate a validation data set, which is than used to calculate</span>
    <span class="c1"># the self.mean_val_loss and to check for overfitting.</span>
    <span class="c1"># Here, we don&#39;t need to do so because the model is not very complex and</span>
    <span class="c1"># we have plenty of data to train the model.</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the fit function of the model.</span>

<span class="sd">        :param trainX: The features.</span>
<span class="sd">        :param trainy: The label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Initialize the Lasso model form the sci-kit learn package</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>

        <span class="c1"># fit the model to the training data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span><span class="n">trainy</span><span class="p">)</span>

        <span class="c1"># MANDETORY: Save the Score under self.mean_val_loss. This variable</span>
        <span class="c1"># will be used to be optimized during the random search later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_val_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainy</span><span class="p">)</span>

    <span class="c1"># MANDATORY: The model needs to have a .fit() function that takes as arguments.</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a prediction.</span>

<span class="sd">        :param: A feature set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># MANDATORY: Function needs to return a value (the prediction).</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># MANDATORY: The model needs to have a .save() function. The location where to save the model</span>
    <span class="c1"># is defined by the keyword arguments &#39;location&#39; and &#39;name&#39;</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">dir_name</span><span class="o">=</span><span class="s1">&#39;mlr&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments of this function are mandetory and used to systemically</span>
<span class="sd">        save models in your modeldir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">f</span><span class="s1">&#39;model.sav&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>

    <span class="c1"># MANDATORY: The model needs to have a .load() function. The location where to saved model can be found</span>
    <span class="c1"># is defined by the keyword arguments &#39;location&#39; and &#39;name&#39;</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">dir_name</span><span class="o">=</span><span class="s1">&#39;mlr&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments of this function are mandetory and used to systemically</span>
<span class="sd">        load models from your modeldir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">f</span><span class="s1">&#39;model.sav&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using TensorFlow backend.
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Cross-train-the-model">
<h2>Cross train the model<a class="headerlink" href="#Cross-train-the-model" title="Permalink to this headline">¶</a></h2>
<p>In the cross_training() function the model is trained on a 5 of 6 time “decades” (1962-1971, 1972-1981,…, 2012-2018). For each decade, 50 search iterations with a random uniform choice of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> between 0. and 0.001 is performed. The model that has the best score (in terms of <code class="docutils literal notranslate"><span class="pre">self.mean_val_loss</span></code>, see above) is saved in the model directory.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ninolearn.learn.fit</span> <span class="k">import</span> <span class="n">cross_training</span>
<span class="n">cross_training</span><span class="p">(</span><span class="n">mlr</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.001</span><span class="p">],</span>  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mlr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

##################################################################
Lead time: 0 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.8094758951404967
{&#39;alpha&#39;: 0.0006389865108761426, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
New best hyperparameters
Mean loss: 0.8094692817259667
{&#39;alpha&#39;: 0.0009598393037831796, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 3/10
Search iteration Nr 4/10
Search iteration Nr 5/10
Search iteration Nr 6/10
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
New best hyperparameters
Mean loss: 0.8094686842331568
{&#39;alpha&#39;: 0.0009836857556539448, &#39;name&#39;: &#39;mlr&#39;}
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0009836857556539448, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.8094686842331568
loss refitting : 0.8094686842331568
mlr_decade1972_lead0 already exists
mlr_decade1982_lead0 already exists
mlr_decade1992_lead0 already exists
mlr_decade2002_lead0 already exists
mlr_decade2012_lead0 already exists

##################################################################
Lead time: 3 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.4886563086165414
{&#39;alpha&#39;: 0.000606099677219931, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
Search iteration Nr 3/10
Search iteration Nr 4/10
New best hyperparameters
Mean loss: 0.48865291157854074
{&#39;alpha&#39;: 0.0007944042759574363, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 5/10
Search iteration Nr 6/10
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0007944042759574363, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.48865291157854074
loss refitting : 0.48865291157854074
mlr_decade1972_lead3 already exists
mlr_decade1982_lead3 already exists
mlr_decade1992_lead3 already exists
mlr_decade2002_lead3 already exists
mlr_decade2012_lead3 already exists
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/paul/miniconda2/envs/ninolearn/lib/python3.6/site-packages/sklearn/linear_model/coordinate_descent.py:475: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 107.17116734450472, tolerance: 0.042875161649484544
  positive)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

##################################################################
Lead time: 6 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.27359880477009446
{&#39;alpha&#39;: 0.0005106845288966993, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
New best hyperparameters
Mean loss: 0.27359709002505495
{&#39;alpha&#39;: 0.000626995025067661, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 3/10
New best hyperparameters
Mean loss: 0.2735936975314077
{&#39;alpha&#39;: 0.0008092687773921267, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 4/10
Search iteration Nr 5/10
Search iteration Nr 6/10
New best hyperparameters
Mean loss: 0.27359327141677314
{&#39;alpha&#39;: 0.0008293361949688865, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
New best hyperparameters
Mean loss: 0.2735902578947911
{&#39;alpha&#39;: 0.0009593472221216335, &#39;name&#39;: &#39;mlr&#39;}
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0009593472221216335, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.2735902578947911
loss refitting : 0.2735902578947911
mlr_decade1972_lead6 already exists
mlr_decade1982_lead6 already exists
mlr_decade1992_lead6 already exists
mlr_decade2002_lead6 already exists
mlr_decade2012_lead6 already exists

##################################################################
Lead time: 9 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.20925019869561215
{&#39;alpha&#39;: 0.0006824009115007106, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
Search iteration Nr 3/10
Search iteration Nr 4/10
New best hyperparameters
Mean loss: 0.20924630487479634
{&#39;alpha&#39;: 0.000874571154763512, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 5/10
Search iteration Nr 6/10
New best hyperparameters
Mean loss: 0.20924357113764858
{&#39;alpha&#39;: 0.0009873888944211854, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0009873888944211854, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.20924357113764858
loss refitting : 0.20924357113764858
mlr_decade1972_lead9 already exists
mlr_decade1982_lead9 already exists
mlr_decade1992_lead9 already exists
mlr_decade2002_lead9 already exists
mlr_decade2012_lead9 already exists

##################################################################
Lead time: 12 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.20681268398908717
{&#39;alpha&#39;: 0.0009776809179163517, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
Search iteration Nr 3/10
Search iteration Nr 4/10
Search iteration Nr 5/10
Search iteration Nr 6/10
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0009776809179163517, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.20681268398908717
loss refitting : 0.20681268398908717
mlr_decade1972_lead12 already exists
mlr_decade1982_lead12 already exists
mlr_decade1992_lead12 already exists
mlr_decade2002_lead12 already exists
mlr_decade2012_lead12 already exists

##################################################################
Lead time: 15 month
##################################################################

Test period: 1963-01-01 till 1971-12-01
--------------------------------------
Search iteration Nr 1/10
New best hyperparameters
Mean loss: 0.1917244585769392
{&#39;alpha&#39;: 0.0005871325405723177, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 2/10
New best hyperparameters
Mean loss: 0.19172079586220403
{&#39;alpha&#39;: 0.0007872452638641191, &#39;name&#39;: &#39;mlr&#39;}
Search iteration Nr 3/10
Search iteration Nr 4/10
Search iteration Nr 5/10
Search iteration Nr 6/10
Search iteration Nr 7/10
Search iteration Nr 8/10
Search iteration Nr 9/10
Search iteration Nr 10/10
Refit the model with best hyperparamters
{&#39;alpha&#39;: 0.0007872452638641191, &#39;name&#39;: &#39;mlr&#39;}
best loss search: 0.19172079586220403
loss refitting : 0.19172079586220403
mlr_decade1972_lead15 already exists
mlr_decade1982_lead15 already exists
mlr_decade1992_lead15 already exists
mlr_decade2002_lead15 already exists
mlr_decade2012_lead15 already exists
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/paul/miniconda2/envs/ninolearn/lib/python3.6/site-packages/sklearn/linear_model/coordinate_descent.py:475: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 159.33193203632695, tolerance: 0.04285599581151833
  positive)
/home/paul/miniconda2/envs/ninolearn/lib/python3.6/site-packages/sklearn/linear_model/coordinate_descent.py:475: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 169.4946175965277, tolerance: 0.04285599581151833
  positive)
/home/paul/miniconda2/envs/ninolearn/lib/python3.6/site-packages/sklearn/linear_model/coordinate_descent.py:475: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 157.01499701626796, tolerance: 0.04285599581151833
  positive)
/home/paul/miniconda2/envs/ninolearn/lib/python3.6/site-packages/sklearn/linear_model/coordinate_descent.py:475: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations. Duality gap: 173.04389211223318, tolerance: 0.042850173842105266
  positive)
</pre></div></div>
</div>
</div>
<div class="section" id="Make-hindcast">
<h2>Make hindcast<a class="headerlink" href="#Make-hindcast" title="Permalink to this headline">¶</a></h2>
<p>Now, each model makes the forecast for the decade on which it was NOT trained by the function cross_training().</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ninolearn.learn.fit</span> <span class="k">import</span> <span class="n">cross_hindcast</span>
<span class="n">cross_hindcast</span><span class="p">(</span><span class="n">mlr</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;mlr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

##################################################################
Lead time: 0 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------

##################################################################
Lead time: 3 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------

##################################################################
Lead time: 6 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------

##################################################################
Lead time: 9 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------

##################################################################
Lead time: 12 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------

##################################################################
Lead time: 15 months
##################################################################

Predict: 1963-01-01 till 1971-12-01
--------------------------------------
Predict: 1972-01-01 till 1981-12-01
--------------------------------------
Predict: 1982-01-01 till 1991-12-01
--------------------------------------
Predict: 1992-01-01 till 2001-12-01
--------------------------------------
Predict: 2002-01-01 till 2011-12-01
--------------------------------------
Predict: 2012-01-01 till 2017-12-01
--------------------------------------
</pre></div></div>
</div>
</div>
<div class="section" id="Evaluation">
<h2>Evaluation<a class="headerlink" href="#Evaluation" title="Permalink to this headline">¶</a></h2>
<p>Finally the model can be evaluated using the Pearson correlation and she standardized root-mean-squarred error (SRMSE). The SRMSE is the RMSE that is divided by the standard deviation of each season. This skill measure needs to be used instead of the RMSE because the ONI has a seasonal cycle of the standard deviation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MaxNLocator</span>


<span class="kn">from</span> <span class="nn">ninolearn.learn.fit</span> <span class="k">import</span> <span class="n">n_decades</span><span class="p">,</span> <span class="n">lead_times</span><span class="p">,</span> <span class="n">decade_color</span><span class="p">,</span> <span class="n">decade_name</span>
<span class="kn">from</span> <span class="nn">ninolearn.learn.evaluation</span> <span class="k">import</span> <span class="n">evaluation_correlation</span><span class="p">,</span> <span class="n">evaluation_decadal_correlation</span><span class="p">,</span> <span class="n">evaluation_seasonal_correlation</span>
<span class="kn">from</span> <span class="nn">ninolearn.learn.evaluation</span> <span class="k">import</span> <span class="n">evaluation_srmse</span><span class="p">,</span> <span class="n">evaluation_decadal_srmse</span><span class="p">,</span> <span class="n">evaluation_seasonal_srmse</span>
<span class="kn">from</span> <span class="nn">ninolearn.plot.evaluation</span> <span class="k">import</span> <span class="n">plot_seasonal_skill</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># =============================================================================</span>
<span class="c1"># All season correlation skill</span>
<span class="c1"># =============================================================================</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="c1"># scores on the full time series</span>
<span class="n">r</span><span class="p">,</span> <span class="n">p</span>  <span class="o">=</span> <span class="n">evaluation_correlation</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>

<span class="c1"># score in different decades</span>
<span class="n">r_dec</span><span class="p">,</span> <span class="n">p_dec</span> <span class="o">=</span> <span class="n">evaluation_decadal_correlation</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>

<span class="c1"># plot correlation skills</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_decades</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">r_dec</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">decade_color</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;Deep Ens.  (</span><span class="si">{decade_name[j]}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Deep Ens.  (1962-2017)&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">lead_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lead Time [Months]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_notebook_tutorials_StandardizedResearch_14_0.png" src="../_images/jupyter_notebook_tutorials_StandardizedResearch_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># =============================================================================</span>
<span class="c1"># All season SRMSE skill</span>
<span class="c1"># =============================================================================</span>
<span class="n">srmse_dec</span> <span class="o">=</span> <span class="n">evaluation_decadal_srmse</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>
<span class="n">srmse</span> <span class="o">=</span> <span class="n">evaluation_srmse</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>

<span class="c1"># plot SRMSE skills</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_decades</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">srmse_dec</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">decade_color</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;Deep Ens.  (</span><span class="si">{decade_name[j]}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">srmse</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Deep Ens.  (1962-2017)&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">lead_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lead Time [Months]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SRMSE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_notebook_tutorials_StandardizedResearch_15_0.png" src="../_images/jupyter_notebook_tutorials_StandardizedResearch_15_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># =============================================================================</span>
<span class="c1"># Seasonal skills</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># evaluate the model in different seasons</span>
<span class="n">r_seas</span><span class="p">,</span> <span class="n">p_seas</span> <span class="o">=</span> <span class="n">evaluation_seasonal_correlation</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>

<span class="n">plot_seasonal_skill</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">r_seas</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">p_seas</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation skill&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">srsme_seas</span> <span class="o">=</span> <span class="n">evaluation_seasonal_srmse</span><span class="p">(</span><span class="s1">&#39;mlr&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>
<span class="n">plot_seasonal_skill</span><span class="p">(</span><span class="n">lead_times</span><span class="p">,</span> <span class="n">srsme_seas</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SRMSE skill&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_notebook_tutorials_StandardizedResearch_16_0.png" src="../_images/jupyter_notebook_tutorials_StandardizedResearch_16_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_notebook_tutorials_StandardizedResearch_16_1.png" src="../_images/jupyter_notebook_tutorials_StandardizedResearch_16_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deep_ensemble.html" class="btn btn-neutral float-right" title="Deep ensemble for ENSO-forecasting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="postprocess_data.html" class="btn btn-neutral float-left" title="Postprocess data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Paul Petersik
      <span class="lastupdated">
        Last updated on Oktober 14, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>